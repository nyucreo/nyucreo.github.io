{{ define "main" }}
{{ $permalink := .Permalink }}

<div class="universal-wrapper">
  
  {{/* Page Title */}}
  <div class="page-header">
    <h1>{{ .Title }}</h1>
    {{ with .Params.subtitle }}
      <p class="text-muted">{{ . }}</p>
    {{ end }}
  </div>

  {{/* Research Groups Grid */}}
  <div id="research-groups-grid">
    <!-- 修改：给容器加内联 Grid，一行三列 -->
    <div class="research-groups-container"
         style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1.5rem;align-items:start;">  <!-- 修改 -->

      {{ range .Pages }}
        <div class="research-group-card">
          <!-- 修改：让卡片链接块级化，便于卡片占满栅格 -->
          <a href="{{ .RelPermalink }}" class="card-link"
             style="display:block;text-align:center;padding:12px;border:1px solid rgba(0,0,0,.08);border-radius:12px;"> <!-- 修改 -->

            {{/* Logo/Featured Image */}}
            {{ $resource := .Resources.GetMatch "featured*" }}
            {{ if $resource }}
              <div class="card-image">
                {{ $image := $resource.Resize "300x" }}
                <img src="{{ $image.RelPermalink }}" alt="{{ .Title }}" loading="lazy"
                     style="height:110px;object-fit:contain;display:block;margin:0 auto;"> <!-- 修改：统一尺寸 -->
              </div>

            {{ else if .Params.image }}
              {{/* 修改：兼容 image 为字符串或 {filename:..} 的写法 */}}       <!-- 修改 -->
              {{ $src := "" }}                                                      <!-- 修改 -->
              {{ $pi := .Params.image }}                                            <!-- 修改 -->
              {{ $t := printf "%T" $pi }}                                           <!-- 修改 -->
              {{ if eq $t "string" }}                                               <!-- 修改 -->
                {{ $src = $pi }}                                                    <!-- 修改 -->
              {{ else if (and (isset $pi "filename") (ne (index $pi "filename") "")) }} <!-- 修改 -->
                {{ $src = (printf "media/%s" (index $pi "filename")) }}             <!-- 修改 -->
              {{ end }}                                                             <!-- 修改 -->
              {{ if ne $src "" }}                                                   <!-- 修改 -->
                <div class="card-image">                                            <!-- 修改 -->
                  <img src="{{ $src | relURL }}" alt="{{ .Title }}" loading="lazy"
                       style="height:110px;object-fit:contain;display:block;margin:0 auto;"> <!-- 修改 -->
                </div>                                                              <!-- 修改 -->
              {{ end }}                                                             <!-- 修改 -->
            {{ end }}
            
            {{/* Card Content：只保留标题 */}}
            <div class="card-content" style="margin-top:.5rem;"> <!-- 修改：简化为只显示 Title -->
              <h3 class="card-title" style="font-size:1.05rem;margin:0;">{{ .Title }}</h3> <!-- 修改 -->
              {{/* 删除副标题/摘要展示，如需可恢复 */}}
            </div>
          </a>
        </div>
      {{ end }}
    </div>
  </div>
</div>

{{ end }}
